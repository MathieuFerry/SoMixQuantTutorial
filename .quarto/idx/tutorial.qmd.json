{"title":"A short example with HIES 2019","markdown":{"headingText":"A short example with HIES 2019","containsRefs":false,"markdown":"\nIn this section, we provide an example of statistical analysis using data from the HIES 2019. We focus here on a short analysis on **school attendance in Sri Lanka**, and on the socio-demographic charactistics of individuals who attend school and of those who drop out.\n\nIn this section, you will find:\n\n-   the R script that we used;\n\n-   the statistical outputs that we produced (Tables and Figures);\n\n-   how to read and interpret these statistical outputs;\n\n-   what we conclude from these statistical analyses.\n\nThis is the kind of work you will need to do on the topic you have chosen. Of course, you will have to adapt the **variables used** and the kind of analysis (tables, figures, etc.) to your **specific research question**!\n\nIn this tutorial, we focus on the final statistical outputs that we have decided to keep. Hence, we do not show **all the different steps of our statistical reasoning** that we have done to explore the database and our variables (for example, using univariate statistics) nor the (many!) attempts that we have performed to eventually end up with only 3-4 outputs that we think best summarize the information we need for our research question.In particular, we do not present the unweighted-N frequency tables here, but it is always advisable to run them, as cells with very small Ns may require more cautious interpretation.\n\nKeep in mind that this is only **one possible analysis**: other outputs could have been possible focusing on the same research question. The important aspect here is that no matter how you eventually decide to present your results, the key information needs to be **clear** and **accessible** (in this example, who attends school and who drops out, basically).\n\n## Introduction\n\nAs we explained in previous sections, we first install (and load if necessary) the different **packages** that we will need to perform our statistical analyses. We then load the `edu.rds` **database** that we are going to use for our research question.\n\n```{r}\n#| warning: false\n\n# List required packages in a vector called load.lib. \nload.lib <- c(\"tidyverse\",\"questionr\",\"Hmisc\",\"esquisse\",\"kableExtra\") \n\ninstall.lib <- load.lib[!load.lib %in% installed.packages()] # Examine packages which are not yet installed\n\nfor (lib in install.lib) install.packages(lib,dependencies=TRUE) # Install those if required\n\nsapply(load.lib,require,character=TRUE) # Load all packages. \n\n#Load data\nsetwd(\"/home/groups/3genquanti/SoMix/HIES for workshop\")\nedu<-readRDS(\"edu.rds\")\n```\n\nOur main **dependent variable** is *r2_school_education* which refers to the third column of the table on \"School Education (For persons aged from 5 to 19 years)\" in the questionnaire Section 2 (p.324 of the report available on the shared Drive).\n\nIt is coded as follows: modality 1 stands for \"Currently attending school\", 2 for \"Never attended school\" and 3 for \"Attended school in the past\". Yet, in the `edu.rds` database, we only have these modalities as numbers (1, 2, or 3) and not what they mean. In order to make our tables and graphs **easier to read**, we apply the appropriate labels to each value of this variable.\n\nThis is what the following script does. Note that you can well use the function `irec` that we introduced in the second chapter to **recode your variables**. Besides, it is always good practice to check whether your recoding went well by comparing the initial and recoded variable, here: `edu |> freqtable(r2_school_education,r2_school_education_rec)`.\n\n```{r}\n#Recode the variable on school attendance\nedu$r2_school_education_rec <- edu$r2_school_education  |>\n  as.character() |>\n  fct_recode(\n    \"Currently attending\" = \"1\",\n    \"Never attended\" = \"2\",\n    \"Attended school in the past\" = \"3\"\n  )\n```\n\nSimilarly to what we did in the previous section on bivariate and multivariate statistics, we need to create a function that would combine the analysis of **three different variables**:\n\n```{r}\n\n# Function ----------------------------------------------------------------\n\nkbl_grouped_3way <- function(tab, digits = 1) {\n  \n  # Convert to a dataframe without dropping: NA conservés\n  df <- as.data.frame(tab, stringsAsFactors = FALSE, drop = FALSE)\n  \n  # Identify the three dimensions\n  dims <- names(df)[names(df) != \"Freq\"]\n  dim1 <- dims[1]   # ligne\n  dim2 <- dims[2]   # colonne\n  dim3 <- dims[3]   # groupe\n  \n  # To character\n  df[ dims ] <- lapply(df[ dims ], function(x) ifelse(is.na(x), NA, as.character(x)))\n  \n  # Pivot wider\n  df_wide <- df |>\n    tidyr::pivot_wider(\n      names_from = all_of(dim2),\n      values_from = Freq,\n      values_fill = 0\n    )\n  \n  # Keep order\n  grouping_var <- df_wide[[dim3]]\n  \n  # Construct kable\n  tab_out <- df_wide |>\n    dplyr::select(-all_of(dim3)) |>\n    kbl(digits = digits)\n  \n  # Group levels (including NA)\n  group_levels <- unique(grouping_var)\n  \n  # Line index by group\n  groups <- split(seq_len(nrow(df_wide)),\n                  f = ifelse(is.na(grouping_var), \"NA\", grouping_var))\n  \n  # Pack_rows for each group in kable\n  for (g in names(groups)) {\n    rows <- groups[[g]]\n    tab_out <- tab_out |>\n      pack_rows(group = g,\n                start_row = min(rows),\n                end_row = max(rows))\n  }\n  \n  tab_out\n}\n\n```\n\n## School non-attendance by sex and age\n\nWe first explore how attendance to school vary by **sex** and **age**. Indeed, there are reasons to think that drop out will be more likely to happen for older students. In Sri Lanka, school is compulsory until age 14, so we can imagine that **attendance will decrease only from this age**. Is this was we observe in the data? And are there some differences for male and female students?\n\nWe use the following code to produce a frequency table (with weighted percentages) to see how the distribution of each category of our dependent variable (school attendance, in column) vary according to the two independent variables we just mentioned: sex and age.\n\n```{r}\n\n# Frequency table of school attendance by age and sex ----------------------------------------------------------------\n\nm<-edu |> freqtable(age,r2_school_education_rec,sex,weights=finalweight_25per) |>\n  lprop() \n\nkbl_grouped_3way(m,digits=0)|>\n  kable_classic_2(full_width = FALSE)\n\n#Note the digits=0 argument here which means that % will be shown without any digit\n#We don’t need that level of precision (especially since the data comes from a survey and\n#has a margin of error), and the extra digits can obscure the message of the table\n```\n\n-   This table shows specific patterns by age.\n\n    -   Until age 15, the vast majority of children are currently attending school. This is true both for male and female students. However, from age 15, drop outs increase. Among male respondents aged 15 at the time of the survey, 97.6% were currently attending school. Yet, this proportion later shrinks: they are only 74.1% among male respondents aged 16, and 21.9% for those aged 19.\n\n    -   Conversely, the percentage of individuals who dropped out school increases with age: it goes from only 2.4% of 15 year-old men to 77.6% for 19 year-old men.\n\n-   Overall, we observe a similar pattern for women: school attendance rates are very high until age 15, and then consistently decrease with age. Interestingly, we also see some differences by sex. Drop out rates are larger for men than for women: while drop out rate among male respondents aged 19 is around 78%, this proportion only reaches 62% among female respondents.\n\n-   Finally, note that the proportion of students who never attended school is very negligible.\n\n## School non-attendance and locality\n\nAre there some differences in school attendance by **place of residence**? We saw in previous sections that distance to school tends to be higher in rural areas. In that context, can we expect school attendance to be larger in urban areas in comparison to rural sectors?\n\nTo investigate this question, we want to check whether the rate of school attendance is similar in urban, rural areas and estates. As we observed in the previous table, school attendance greatly varies by age, so we may want to take this variable into account when exploring the differences by locality.\n\nFor the sake of concision and to ensure that the table is not too difficult to read, we need to select the variables we want to study. Therefore, we have decided not to include the sex variable: while we observed some differences by sex, the main driver of school attendance observed in the first table was age. Further analyses could later explore the specificity of school attendance by type of locality and sex. In this same vein, we run analyses only on individuals above 14, as we saw in the previous table that school attendance does not vary for younger respondents: in that case, it is best to keep only the important information so as **not to overwhelm the reader with too much detail**!\n\n```{r}\n\n# First, recode the sector (residence) variable\n\n  edu$sector_rec <- edu$sector  |>\n  as.character() |>\n  fct_recode(\n    \"Urban\" = \"1\",\n    \"Rural\" = \"2\",\n    \"Estate\" = \"3\"\n  )\n\n\n# Second, we keep only individuals in our database aged at least 14--------------------------\nedu14<- edu |> \n  filter(age>=14)\n\n# Third, frequency table of school attendance by age and locality--------------------------\nm<-edu14 |> freqtable(age,r2_school_education_rec,sector_rec,weights=finalweight_25per) |>\n  lprop() \nkbl_grouped_3way(m,digits=0)|>\n  kable_classic_2(full_width = FALSE)\n```\n\nInterestingly, there do not appear to be **strong differences** in school attendance status across residential locality types. If anything, urban children seem slightly more likely to be out of school than rural or estate children. This pattern is somewhat surprising, as we might have expected rural children to be more prone to dropping out due to more limited access to schools at higher grade levels.\n\n## School non-attendance and family background\n\nSchool attendance is likely to be associated with **family’s social background** for at least two reasons.\n\n-   First, **cultural capital** may play a role: parents with higher levels of education are often better equipped to support and value continued schooling.\n\n-   Second, **economic factors** matter: for families with fewer resources, the **opportunity cost** of keeping a child in school—rather than contributing to household income or domestic work—may be higher.\n\nDo these hypotheses ring a bell with specific sociological theories? Say, maybe Bourdieu's theory of cultural reproduction or Boudon's theory of opportunity (secondary effects)?\n\nWe can have a look whether parental education and household wealth matter.\n\nFor parental education, notice that for about 16 percent of children parental education is unknown (in fact, these children are not the children of the household head so in the survey we could not match them to any parent).\n\nLet's examine how parental education affects school drop out at each age:\n\n```{r}\n\nm<-edu14 |> freqtable(edu_parent,r2_school_education_rec,age,weights=finalweight_25per) |>\n  lprop() \nkbl_grouped_3way(m,digits=0)|>\n  kable_classic_2(full_width = FALSE)\n\n```\n\n-   Below age 16, the share of children not attending school is much higher among those whose parents have less than a primary education; for children of more educated parents, non-attendance is virtually nonexistent.\n\n-   From age 16 onward, the overall pattern follows a clear gradient: children with lower-educated parents are more likely to leave school, while those with highly educated parents are more likely to remain enrolled.\n\n-   It is also noteworthy that children whose parents’ education is unknown show above-average levels of non-attendance. This group may have a distinct background—for instance, some may not be the household head’s own children and might be growing up in large joint families or without their parents.\n\n```{r}\n\nm<-edu14 |> freqtable(hhwealthcat,r2_school_education_rec,age,weights=finalweight_25per) |>\n  lprop() \nkbl_grouped_3way(m,digits=0)|>\n  kable_classic_2(full_width = FALSE)\n\n```\n\nWealth differences become more pronounced in late adolescence:\n\n-   At ages 14–15, past attendance remains very low across all categories, indicating that early dropout is rare regardless of household wealth.\n\n-   From age 16 onward, however, the proportion of children who have left school rises steadily, especially among poorer households.\n\n-   By ages 17–18, children in the poorest group show the highest levels of past attendance (44–53%), while those in the richest households are much less likely to have exited school.\n\n-   At age 19, past attendance becomes the majority status for all groups, though it remains somewhat lower among the richest, highlighting that wealth increasingly shapes school persistence as children grow older.\n\n## Reasons for dropping out\n\nWe can dig in a bit deeper on the students who attended school in the past by checking the reasons for leaving school. Again, we need to recode the categories of this variable called `r2_school_education`.\n\n```{r}\nedu14notcurrently<-edu14 |> filter(r2_school_education_rec==\"Attended school in the past\")\nedu14notcurrently$reason_leave_school_rec <- edu14notcurrently$reason_leave_school  |>\n  as.character() |>\n  fct_recode(\n    \"Further schooling not available or too far away\" = \"1\",\n    \"Financial problems\" = \"2\",\n    \"House keeping / Family business\" = \"3\",\n    \"Disability\" = \"4\",\n    \"Illness\" = \"5\",\n    \"Not willing / poor academic progress\" = \"6\",\n    \"Pending results (GCE)\" = \"7\",\n    \"Complete GCE / Grade 13\" = \"8\",\n    \"Engaged in an economic activity\" = \"9\",\n    \"Other\" = \"99\"\n  )\n\nedu14notcurrently |> freqtable(reason_leave_school_rec,weights=finalweight_25per) |>\n  freq() |> select(-n) |>\n  kbl(digits=0) |> kable_classic(full_width = F)\n\n```\n\nThis variable is rather subjective, and its categories may overlap with one another. Ideally, we would also have preferred to rely on more objective indicators of school achievement. Despite the presence of ten distinct response options, the reasons for leaving school can be **grouped into a few broader blocks**.\n\n-   **Opportunity-cost reasons** include financial problems (7%), household or family business responsibilities (4%), and engagement in economic activity (13%).\n\n-   **Academic-related reasons** are dominated by ‘not willing / poor academic progress,’ which is by far the most frequently cited reason (37%).\n\n-   A small share relates to **institutional or availability issues,** such as further schooling being unavailable or too far away (1%, very low!) or pending GCE results (14%) to continue further.\n\n-   **Personal health issues**, including disability (1%) and illness (1%) account for a small share of the cited reasons.\n\n-   The **Other** category represents 7% of the children not attending school, and unfortunately we cannot do anything about it.\n\n-   *Having completed GCE / grade 13* is important to keep in mind here: these children already have completed secondary and this section of the survey does not keep track whether children are engaging into tertiary education so they should be left out in further analyses.\n\nLet us recode the reasons for leaving school into these broader categories (noting that this recoding may be open to criticism or revision) and filter out the children having completed secondary school in order to streamline the analysis.\n\n```{r}\nedu14nocurnocomp <-edu14notcurrently |> filter(reason_leave_school_rec!=\"Complete GCE / Grade 13\")\n  \nedu14nocurnocomp$reason_leave_streamlined <- edu14nocurnocomp$reason_leave_school_rec  |>\nfct_recode(\n  \"Institutional / Availability\" = \"Further schooling not available or too far away\",\n  \"Opportunity-cost\" = \"Financial problems\",\n  \"Opportunity-cost\" = \"House keeping / Family business\",\n  \"Personal health issues\" = \"Disability\",\n  \"Personal health issues\" = \"Illness\",\n  \"Academic achievement-related\" = \"Not willing / poor academic progress\",\n  \"Institutional / Availability\" = \"Pending results (GCE)\",\n  \"Opportunity-cost\" = \"Engaged in an economic activity\"\n)\n#Remove unused levels (Complete GCE / Grade 13)\nedu14nocurnocomp$reason_leave_streamlined <- droplevels(edu14nocurnocomp$reason_leave_streamlined)\n\nedu14nocurnocomp |> freqtable(reason_leave_streamlined,weights=finalweight_25per) |>\n  freq() |> select(-n) |>\n  kbl(digits=0) |> kable_classic(full_width = F)\n\n```\n\nWith this streamlined variable, we then investigate how they vary according to parent education and household wealth:\n\n```{r}\nedu14nocurnocomp |> freqtable(edu_parent,reason_leave_streamlined,weights=finalweight_25per) |>\n  rprop() |> \n  kbl(digits=0) |> kable_classic(full_width = F)\n\n```\n\n```{r}\nedu14nocurnocomp |> freqtable(hhwealthcat,reason_leave_streamlined,weights=finalweight_25per) |>\n  rprop() |> \n  kbl(digits=0) |> kable_classic(full_width = F)\n\n```\n\nTaken together, the two tables show that **both parental education and household wealth shape the reasons why children leave school**, but in somewhat different ways.\n\n-   Among children from **less educated or poorer households**, school exit is most often linked to **academic-achievement–related issues** and **opportunity-cost pressures**, suggesting that learning difficulties and the need to contribute economically remain key constraints. As parental education and wealth increase, however, academic and economic pressures diminish.\n\n    -   E.g., more than half (54%) of the children with less than primary educated parents cite academic-achievement-related issues (while only 24% of children with tertiary-educated parents cite this issue)\n\n    -   E.g., about 40% of poorest children cite opportunity-cost pressures, but only 30% of the richest children.\n\n-   As parental education and wealth increase, **institutional or availability factors**—such as limited options for further schooling—become more prominent. At the top of the socioeconomic spectrum, these structural constraints partly replace academic or financial motivations as the main reasons for leaving school.\n\n    -   E.g., 33% of the richest children cite this reason but only 11% of poorest children do.\n\nNotice that having filtered out children who had completed GCE/Grade 13 (i.e. those who have completed secondary school) means that none of the children with tertiary-educated parents are out of school, reinforcing the association between parents' education and children's dropouts.\n\n## Limits (and possible ways to solve them)\n\nOur analysis has some limitations (or observations to bear in mind).\n\n-   We adopted an age-cohort approach, implicitly assuming that children of different ages (e.g., 14 vs. 15) can be compared directly. This could imply, for example, that children who dropped out at age 15 are assumed to have done so in that year. But it would not be accurate to think that way—children aged 17, for instance, may have left school several years earlier. This issue could be explored further using the variable `when_stop_schooling`, which indicates the year in which each child dropped out.\n\n-   We also did not consider another issue beyond dropping out: class/grade for age. Even if children are attending school, they may be late for their age, because they have started school later than their peers or because they repeated a class. The variables `grade_this_year` and `grade_last_year` may be of interest to examine this.\n\n## Possible qualitative extensions\n\nQualitative field material could enrich our understanding of school attendance and dropout. For example, interviews with students, parents, and teachers could provide insights into:\n\n-   The reasons why children leave school **that are not captured by survey categories** (and whether they sometimes overlap);\n\n-   How **parents' expectations** shape educational decisions (to drop out);\n\n-   How parents and children **perceive the value of education** (and whether it is worth going to school if it is not compulsory);\n\n-   **Localized barriers to school attendance** (even if rural does not seem associated to more drop outs, are there some specific areas where school density is less present at higher grades?).\n\n## Preliminary conclusion\n\nOverall, school attendance in Sri Lanka is high at younger ages but declines steadily from age 16, with dropouts more common among children from poorer households or with less-educated parents. Academic challenges and opportunity costs are the main reasons for leaving school among disadvantaged children, while institutional constraints become more important for children from wealthier or more educated families.\n\nFor a report:\n\n-   This analysis should be extended with further academic literature on education school drop out, for instance, in Sri Lanka, see [Lindberg, 2010](https://doi.org/10.1111/j.1467-7660.2009.01633.x%20Click%20and%20Read) or [Arunatilake, 2006](https://doi-org.scpo.idm.oclc.org/10.1016/j.ijer.2006.11.001) (they are now a bit old and you should also search for more recent articles).\n\n-   We have not included graphics here, but they are always a useful way to convey information to an audience. You can use esquisse, as introduced in previous chapters, or export the tables you want to visualize into your preferred spreadsheet software to create graphics when finalizing your analysis.\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"tutorial.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.5.57","editor":"visual","theme":"cosmo"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}