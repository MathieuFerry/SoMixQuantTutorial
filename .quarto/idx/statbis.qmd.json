{"title":"Bivariate statistics and more graphics","markdown":{"headingText":"Bivariate statistics and more graphics","containsRefs":false,"markdown":"\nIn this section, we now review a slightly more complex type of descriptive statistics: **bivariate statistics** i.e. statistics with at least two distinct variables. We sill use data from the `educ.rds` dataset. We also use the same packages that we introduced in the previous section (section 2) on univariate statistics.\n\n::: {.callout-note title=\"Exercise\"}\n-   Create an empty R script.\n\n-   Save this script in a folder (for instance, \"WinterWorkshop\") and name it for instance \"3Statbis.R\".\n\n-   Load the edu database and run the commands below to install/load packages.\n\n```{r}\n#| eval: false\n# On liste les packages dont on a besoin dans un vecteur nommé load.lib. \nload.lib <- c(\"tidyverse\",\"questionr\",\"Hmisc\",\"esquisse\",\"kableExtra\") \ninstall.lib <- load.lib[!load.lib %in% installed.packages()] # On regarde les paquets qui ne sont pas installés\nfor (lib in install.lib) install.packages(lib,dependencies=TRUE) # On installe ceux-ci\nsapply(load.lib,require,character=TRUE) # Et on charge tous les paquets \n\n\n\nsetwd(\"/home/groups/3genquanti/SoMix/HIES for workshop\")\nedu<-readRDS(\"edu.rds\")\n\n```\n:::\n\n## The association between a categorical variable and a numerical variable\n\nIn section 2 on univariate statistics, we discussed several indicators of the distribution of a numerical variable (minimum, maximum, mean, median). Thanks to the lines of code already set up, it is easy to calculate these statistics for different categories of another categorical variable.\n\nYou simply need to add another function to compute these statistics for each category of a variable, namely `group_by`:\n\n```{r}\n#| eval: false\nedu |>\n  group_by(province) |>\n  summarise(\n    min    = min(distance, na.rm = TRUE),\n    mean   = wtd.mean(distance,weights=finalweight_25per,na.rm = TRUE),\n    median = wtd.quantile(distance,probs=.5,weights=finalweight_25per,na.rm = TRUE),\n    max    = max(distance, na.rm = TRUE),\n    n_na   = sum(is.na(distance))\n  )\n\n\n```\n\nLet’s study the distance to school according to the place of residence: urban, rural, or estate. This corresponds to the variable sector, with categories 1, 2, and 3. We can recode these categories using the icut() interface, or directly with the following code:\n\n```{r}\n#| eval: false\n\nedu$sector_rec <- edu$sector  |>\n  as.character() |>\n  fct_recode(\n    \"Urban\" = \"1\",\n    \"Rural\" = \"2\",\n    \"Estate\" = \"3\"\n  )\n\nedu |>\n  group_by(sector_rec) |>\n  summarise(\n    min    = min(distance, na.rm = TRUE),\n    mean   = wtd.mean(distance,weights=finalweight_25per,na.rm = TRUE),\n    median = wtd.quantile(distance,probs=.5,weights=finalweight_25per,na.rm = TRUE),\n    max    = max(distance, na.rm = TRUE),\n    n_na   = sum(is.na(distance))\n  )\n\n```\n\nWe can analyse how the distance to school varies across multiple categorical variables. For example, we can compute the mean and the median with respect to both the province and the place of residence:\n\n```{r}\n#| eval: false\n\nedu |>\n  group_by(province,sector_rec) |>\n  summarise(\n    mean   = wtd.mean(distance,weights=finalweight_25per,na.rm = TRUE),\n    median = wtd.quantile(distance,probs=.5,weights=finalweight_25per,na.rm = TRUE)\n  ) |> \n  kbl(digits=1) |> kable_classic(full_width = F)\n```\n\n![Urban-rural gap in distance to school by province](images/Capture%20d’écran%202025-11-21%20à%2021.58.25.png){fig-align=\"center\"}\n\nThe distance to school tends to be higher in rural areas, and this difference is mainly driven by extreme values. Indeed, it is primarily the mean, which is more sensitive to large values, that reflects this gap, more so than the median.\n\n```{r}\n#| eval: false\n\nedu |>\n  group_by(province,sector_rec) |>\n  summarise(\n    mean   = wtd.mean(distance,weights=finalweight_25per,na.rm = TRUE) \n  ) |> \n  pivot_wider(names_from=sector_rec,values_from=mean) |>\n  mutate(`Urban-Rural difference`=Urban-Rural) |>\n  kbl(digits=1) |> kable_classic(full_width = F)\n\n```\n\n![Urban-rural gap in distance to school by province](images/Capture%20d’écran%202025-11-21%20à%2021.57.52.png){fig-align=\"center\"}\n\nWe can clearly see from this last analysis that this pattern holds in all provinces (except North Western), but the gap varies: it is higher in the Sabaragamuwa and Southern provinces, where the distance to school for children in estate areas is particularly pronounced.\n\n### Summarizing with the mean and the standard deviation\n\nIt is quite common in scientific articles to describe quantitative variables by reporting the mean (a measure of central tendency) and the standard deviation (a measure of dispersion, equal to the square root of the variance).\n\n```{r}\n#| eval: false\nedu |>\n  group_by(sector_rec) |>\n  summarise(\n    mean= mean(distance,na.rm=T),\n    sd= sd(distance,na.rm=T),\n  ) |>\n  kbl(digits=1) |> kable_classic(full_width = F)\n```\n\n![Mean and standard deviation of distance to school by residence](images/Capture%20d’écran%202025-11-21%20à%2022.06.22.png){fig-align=\"center\"}\n\nWhy are these two indicators used in particular? First, we can say from this table that, on average, the distance to school is higher for children in rural areas than in urban areas. There is also greater variability in the distance to school in rural areas (sd stands for standard deviation).\n\n::: callout-tip\nShould we summarize a variable by its mean or its median?\n\nThe first option is very common (especially in English-language journals) but is not necessarily the most appropriate…\n\nWhen working with skewed (i.e., non-normal) distributions:\n\n-   The mean is sensitive to extreme values in the distribution.\n\n-   It may be best to have a look at both and plot the distributions!\n\nNote: in fact, the standard deviation is then also not really a reliable indicator of dispersion describing the distribution. One may then prefer to calculate quantiles (e.g. quartiles, following Tukey's 5 number summary!).\n:::\n\n::: {.callout-note title=\"Exercise\" icon=\"false\"}\nUsing esquisser, reproduce the following plot. Try to improve it by playing with color palettes, font sizes...\n\nWhat is your take away from this plot and from the previous statistics?\n\n![Density of the distance to school by residence location](images/esquisse-plot.png){fig-align=\"center\"}\n:::\n\n## The association between two categorical variables and the cross-tabulation\n\n### Some conventions for cross-tabulations\n\nWe now come to cross-tabulations to study the associations between two categorical variables.\n\nFirst, let's recall a few analysis conventions. It’s easy to get confused when creating cross-tabulations, so keep the following points in mind:\n\n-   What is my *response variable* (also called *dependent variable*), i.e., the variable assumed to depend on another factor or, in other words, the variable that we want to explain?\n\n-   What is my *independent variable*, i.e., the variable assumed to have an effect on the dependent variable?\n\nHere, we can for example make the assumption that attending school (variable r2_school_education) depends on different variables such as the parents' level of education, but also parental economic status, the place of residence, etc.\n\nTo visualize whether a factor affects a dependent variable, we can create a cross-tabulation in which:\n\n-   The **dependent** variable is placed in the *columns*.\n\n-   The **independent** variable is placed in the *rows*.\n\n-   *Row percentages* are calculated (we need to normalize the row counts to compare them!).\n\n-   We then *compare the rows within the same column*.\n\nOf course, this is theory.\n\nThere are many cases where we might be more interested in column percentages, or even total percentages, or we may want to swap rows and columns. Nevertheless, keeping these simple conventions in mind helps to stay oriented when navigating statistical analyses.\n\n### A practical application of the cross-tabulation\n\nLet's try to do some cross-tabulations then. We again use the functions from the `questionr` package. To create a cross-tabulation of unweighted counts, we can write:\n\n```{r}\n#| eval: false\nedu$r2_school_education_rec <- edu$r2_school_education  |>\n  as.character() |>\n  fct_recode(\n    \"Currently attending\" = \"1\",\n    \"Never attended\" = \"2\",\n    \"Attended school in the past\" = \"3\"\n  )\n\nedu |> freqtable(sector_rec,r2_school_education_rec) |>\n  kbl() |> kable_classic(full_width = F)\n```\n\n![Frequency cross-tabulation](images/Capture%20d’écran%202025-11-22%20à%2013.47.19.png){fig-align=\"center\"}\n\nThe row variable (here `edu_parents`) is the independent variable — it is written first — while the column variable (here `r2_school_education_rec`) is the dependent variable.\n\nThe table of counts is useful because it shows that some cells contain relatively small numbers of observations, which should make us cautious when interpreting the corresponding rows/columns.\n\nTo obtain total percentages (joint percentages):\n\n```{r}\n#| eval: false\nedu |> freqtable(sector_rec,r2_school_education_rec,weights=finalweight_25per) |>\n  prop() |>\n  kbl(digits=1) |> kable_classic(full_width = F)\n```\n\n![Joint percentages](images/Capture%20d’écran%202025-11-22%20à%2013.47.40.png){fig-align=\"center\"}\n\nFrom this table, we can say that the most frequent combination of residential location and children’s schooling status is children living in rural areas who are currently enrolled in school (68% of all children).\n\nWe can also compute column percentages:\n\n```{r}\n#| eval: false\nedu |> freqtable(sector_rec,r2_school_education_rec,weights=finalweight_25per) |>\n  cprop() |>\n  kbl(digits=1) |> kable_classic(full_width = F)\n```\n\n![Column percentages](images/Capture%20d’écran%202025-11-22%20à%2014.02.38.png){fig-align=\"center\"}\n\nHere, we see that among children who are currently in school, 79% live in rural areas (and 79% of all children, regardless of schooling status, live in rural areas).\n\nAmong children who have never attended school, 83% live in rural areas. Children from rural areas are therefore slightly over-represented among those who have never attended school.\n\nConversely, they are slightly under-represented among children who are not currently enrolled but have been enrolled in the past (78%).\n\nFinally, row percentages make interpretation easier when assessing whether there is an association between residential location and schooling:\n\n```{r}\n#| eval: false\nedu |> freqtable(sector_rec,r2_school_education_rec,weights=finalweight_25per) |>\n  lprop() |>\n  kbl(digits=1) |> kable_classic(full_width = F)\n```\n\n![Row percentages](images/Capture%20d’écran%202025-11-22%20à%2013.53.54.png){fig-align=\"center\"}\n\nHere, we see that, regardless of residential location, the most frequent situation for children is to be currently enrolled in school.\n\nOnly 3% of children have never attended school, and this configuration is slightly less common in urban areas and estates. In other words, never having attended school — a very marginal situation overall — is mainly a rural phenomenon.\n\n```{r}\n#| eval: false\nSalaires |> freqtable(race,salaire_quint) |> prop(n=T,digit=0)\n```\n\n::: {.callout-note title=\"Exercise\" icon=\"false\"}\nStudy the association between age and school attendance with a row percentage cross tabulation.\n:::\n\n### From the table to the graphic\n\nEsquisse can again in these cases be used to represent graphically the association between residence and school attendance. Here, our category of interest is specifically \"never attending school\".\n\nYou first need to store the row-percentage tabulation (transformed as a \"data.frame\" using the `as.data.frame()` function) in an object (rtab), then open esquisser with this specific command.\n\n```{r}\n#| eval: false\nrtab<-edu |> freqtable(sector_rec,r2_school_education_rec,weights=finalweight_25per) |>\n  lprop() |> as.data.frame() \nesquisser(rtab)\n```\n\nYou can then drop the residence variable on the X-axis tab and Freq in the Y-axis tab. Using the \"Data\" section at the bottom, remove all the categories of the `r2_school_education_rec` variable, except \"Never attending school\". You can further refine the graphic by increasing the font, changing the axis labels, adding a title...\n\n![Never attending school children](images/Capture%20d’écran%202025-11-22%20à%2014.15.48.png)\n\n### Cross-tabulation with three variables?\n\nVery often, we study social processes that depend on multiple social factors. For instance, school attendance may vary according to age (see above exercise), but age may impact differently school attendance for male and female children.\n\n-   One first easy solution to study this is simply to filter the row percentage cross tabulations according to the different categories of a third variable (here, sex).\n\nFor instance:\n\n```{r}\n#| eval: false\nedu |> \n  filter(sex==\"Male\") |>\n  freqtable(age,r2_school_education_rec,weights=finalweight_25per) |>\n  lprop() |>\n  kbl(digits=0) |> kable_classic(full_width = F)\nedu |> \n  filter(sex==\"Female\") |>\n  freqtable(age,r2_school_education_rec,weights=finalweight_25per) |>\n  lprop() |>\n  kbl(digits=0) |> kable_classic(full_width = F)\n```\n\n![School attendance by age for male children](images/Capture%20d’écran%202025-11-22%20à%2015.46.58.png) ![School attendance by age for female children](images/Capture%20d’écran%202025-11-22%20à%2015.47.07.png)\n\nThis code prints successively two crosstabs in the Viewer panel, but it is not ideal as we would want to see them on the same page.\n\n-   A second relatively easy solution is to create a new variable concatenating together the variables sex and age (individuals are simultaneously characterized by both of these dimensions) and to use it as the independent variable, thanks to the `interaction` function:\n\n```{r}\n#| eval: false\nedu <- edu |>\n  mutate(agef=factor(age),#make sure age is well ordered\n         sex_age=interaction(sex,agef,sep=\" \")) #concatenate age and sex together\nedu |> \n  freqtable(sex_age,r2_school_education_rec,weights=finalweight_25per) |>\n  lprop() |>\n  kbl(digits=0) |> kable_classic(full_width = F)\n```\n\n![Cross tabulation with three variables](images/Capture d’écran 2025-11-28 à 18.27.17.png)\n\n-   Third, we can actually also simply write:\n\n```{r}\n#| eval: false\ntab3<-edu |> \n  freqtable(age,r2_school_education_rec,sex,weights=finalweight_25per) |>\n  lprop() \ntab3\n```\n\n`tab3` contains the three-way cross tabulation. We have simply added the sex variable after the dependent within the `freqtable()` function.\n\nUnfortunately, viewing this bigger table in the Viewer panel is not so straightforward with the existing `kableExtra` functions. One solution is to create our own function that we will be able to use at any time whenever we want to study a 3-way cross tabulation.\n\nRun the following code which will create the `kbl_grouped_3way()` function:\n\n```{r}\n#| eval: false\nkbl_grouped_3way <- function(tab, digits = 1) {\n  \n  # Convert to a dataframe without dropping: NA conservés\n  df <- as.data.frame(tab, stringsAsFactors = FALSE, drop = FALSE)\n  \n  # Identify the three dimensions\n  dims <- names(df)[names(df) != \"Freq\"]\n  dim1 <- dims[1]   # ligne\n  dim2 <- dims[2]   # colonne\n  dim3 <- dims[3]   # groupe\n  \n  # To character\n  df[ dims ] <- lapply(df[ dims ], function(x) ifelse(is.na(x), NA, as.character(x)))\n  \n  # Pivot wider\n  df_wide <- df |>\n    tidyr::pivot_wider(\n      names_from = all_of(dim2),\n      values_from = Freq,\n      values_fill = 0\n    )\n  \n  # Keep order\n  grouping_var <- df_wide[[dim3]]\n  \n  # Construct kable\n  tab_out <- df_wide |>\n    dplyr::select(-all_of(dim3)) |>\n    kbl(digits = digits)\n  \n  # Group levels (including NA)\n  group_levels <- unique(grouping_var)\n  \n  # Line index by group\n  groups <- split(seq_len(nrow(df_wide)),\n                  f = ifelse(is.na(grouping_var), \"NA\", grouping_var))\n  \n  # Pack_rows for each group in kable\n  for (g in names(groups)) {\n    rows <- groups[[g]]\n    tab_out <- tab_out |>\n      pack_rows(group = g,\n                start_row = min(rows),\n                end_row = max(rows))\n  }\n  \n  tab_out\n}\n```\n\nThen, just apply to the tab3 object:\n\n```{r}\n#| eval: false\nkbl_grouped_3way(m,digits=0) |>\n    kable_classic_2(full_width = FALSE)\n```\n\n![School attendance by age and sex](images/Capture%20d’écran%202025-11-22%20à%2015.46.24.png)\n\nOf course, it is also possible to produce a figure, which could for instance look like this:\n\n![Graphic of the school attendance by age and sex](images/Capture%20d’écran%202025-11-22%20à%2015.52.33.png)\n\n::: {.callout-note title=\"Exercise\" icon=\"false\"}\nStudy how the association between age and school attendance vary by residence locality (urban, rural and estate).\n:::\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":false,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"statbis.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.5.57","editor":"visual","theme":"cosmo"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}