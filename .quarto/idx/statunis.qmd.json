{"title":"Survey data and univariate statistics","markdown":{"headingText":"Survey data and univariate statistics","containsRefs":false,"markdown":"\nThis chapter introduces the specifics of performing statistics on survey data based on representative population samples. We focus on the univariate description of variables, both numerical (quantitative) and categorical (qualitative).\n\nWe will need four packages that have not yet been loaded (and that you may not have installed yet).\n\nIn the code below, we provide a suggested approach to check whether the necessary packages for this chapter are installed and to load them into the environment.\n\nWe are using the same dataset as in the previous chapter (`edu`), which you can also load into RStudio.\n\n::: {.callout-note title=\"Exercise\" icon=\"false\"}\n-   Create an empty script.\n\n-   Save this script in a folder (for instance, \"WinterWorkshop\") and name it for instance \"2Statunis.R\".\n\n-   Load the `edu.rds` database and add the commands below to install / load the required packages to use the functions demonstrated in this chapter.\n\n```{r}\n#| eval: false\n# List required packages in a vector called load.lib. \nload.lib <- c(\"tidyverse\",\"questionr\",\"Hmisc\",\"esquisse\",\"kableExtra\") \n\ninstall.lib <- load.lib[!load.lib %in% installed.packages()] # Examine packages which are not yet installed\n\nfor (lib in install.lib) install.packages(lib,dependencies=TRUE) # Install those if required\n\nsapply(load.lib,require,character=TRUE) # Load all packages. \n\n#Load data\nsetwd(\"/home/groups/3genquanti/SoMix/HIES for workshop\")\nedu<-readRDS(\"edu.rds\")\n\n```\n:::\n\n## Working with survey data\n\nThe *Household Income and Expenditure Survey (HIES)* data correspond to a sample of households in Sri Lanka. This sample, thanks to the household selection procedures included in the survey, is representative of the entire population of Sri Lanka.\n\nKeep in mind that the selection is based on a complete enumeration of households and a *random* selection of households included in the sample (in fact, it’s a little more complex, but that’s the general idea).\n\nWhy use a sample instead of surveying the entire population?\n\nIf the survey were exhaustive, it would be a census, which the DCS conducts separately. Sampling allows the collection of high-quality, representative data at lower cost and in less time, and all public and private statistical institutes use this type of survey method.\n\nGenerally, sample data include a **weight variable**. These weights ensure the representativeness of the sample for the entire population (to put it simply, in the most common case, the weights correct biases in data collection because not all selected respondents were actually surveyed, and the weight corrects for these biases).\n\nThese types of data are very common in the social sciences (and the DCS conducts several sample-based surveys, such as the Time Use Survey, the Labor Force Survey, etc.), so it is important to know how to handle them.\n\nThus, all statistical operations performed on HIES files must take this weighting into account. For example, in the previous chapter we calculated the average age of respondents to the education module. Since we did not use a weight variable, we simply calculated the **mean among the respondents**. If we had taken weighting into account, we would have *inferred* the **average age of children between 5 and 19 years old for the entire population**.\n\nIn our *HIES* files, the correct weight variable is `finalweight_25per` (this is a specific weight variable to this sample because we are working with a 25% random sample of the survey sample, which is itself a random sample of the entire population).\n\n## Describing a numerical variable\n\n### Summarise variables based on a few statistics\n\nIn R, we can easily summarize a numerical variable using a few statistical indicators:\n\n-   Minimum\n\n-   Mean\n\n-   Median\n\n-   Maximum\n\nThe minimum and maximum give an idea of the range of values taken by the variable, while the mean and median are measures of central tendency.\n\nIt is often useful to estimate the median in addition to the mean when studying a numerical variable. Indeed, the mean is sensitive to “extreme” values in a distribution.\n\nThe median is the value that separates the lower half from the upper half of a statistical distribution (50% of the population has a lower value, 50% has a higher value). When the mean and median differ greatly, it indicates that the distribution of the variable’s values is not evenly spread around the mean.\n\nTypically, when studying income, the mean is often much higher than the median, because a few individuals have very high incomes, which tends to increase the mean, while the median is a more stable measure of central tendency.\n\nTo obtain these statistics for the variable `distance` which indicates the distance from home to school for children:\n\n```{r}\n#| eval: false\nedu |>\n  summarise(\n    min    = min(distance, na.rm = TRUE),\n    mean   = wtd.mean(distance,weights=finalweight_25per,na.rm = TRUE),\n    median = wtd.quantile(distance,probs=.5,weights=finalweight_25per,na.rm = TRUE),\n    max    = max(distance, na.rm = TRUE),\n    n_na   = sum(is.na(distance))\n  )\n```\n\nNotice that we use `finalweight_25per` to calculate the mean and the median, but not to calculate the minimum and maximum. Here, the minimum and maximum age suggest that some children live very close to their school, but for at least one child, the school is pretty far from home!\n\nThe mean is higher than the median, indicating that a few unusually high distance values are stretching the upper tail of the distribution, resulting in a right-skewed distribution.\n\nWe also added the number of `NA` cases in this variables, i.e. the number of missing variables. In fact, here this corresponds to children who actually do not attend school.\n\nWe produced such a nice output that we would like to display it as a table, but copying and pasting from the console doesn't look very nice…\n\nNo worries — there are plenty of packages in R to create beautiful table outputs. Here, we propose using [kableExtra](https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html) :\n\n```{r}\n#| eval: false\nsummary<-edu |>\n  summarise(\n    min    = min(distance, na.rm = TRUE),\n    mean   = wtd.mean(distance,weights=finalweight_25per,na.rm = TRUE),\n    median = wtd.quantile(distance,probs=.5,weights=finalweight_25per,na.rm = TRUE),\n    max    = max(distance, na.rm = TRUE),\n    n_na   = sum(is.na(distance))\n  )\nsummary |> kbl() |> kable_classic(full_width = F)\n\n#Or to have a lower number of digits for the mean: \nsummary |> kbl(digits=2) |> kable_classic(full_width = F)\n\n\n```\n\nThe function `kbl` transforms the summary object into a table in LaTeX/HTML format, which is displayed in the Viewer (bottom-right panel), and the function `kable_classic` is one of the default formatting options I chose.\n\nThese tables can be customized endlessly (including adding titles, captions, etc.). The main advantage is that they can be copied and pasted cleanly into your report, article, or thesis.\n\n![Table created with kableExtra and displayed in the Viewer](images/Capture%20d’écran%202025-11-21%20à%2018.32.47.png)\n\n### Summarizing a quantitative variable with a graph\n\nAll of this looks nice and seems to suggest that `distance` is a skewed variable with a distribution stretched to the right. Can we visualize the distribution?\n\nWe can use the esquisse package, which provides a point-and-click solution for creating plots. You need to run the following line (be a little patient while the page loads). This avoids having to write the code yourself to create the plot using the `ggplot2` package.\n\n```{r}\n#| eval: false\nesquisser(edu)\n```\n\nThis should load an interface with the different variables from the dataset at the top, which you will need to drag into the corresponding boxes.\n\n![Esquisse interface](images/Capture%20d’écran%202025-11-21%20à%2018.39.30.png)\n\nBy dragging the distance variable into the X box, a histogram is created automatically. You can modify this representation, for example, by choosing a density plot instead. The entire graph is customizable using the options below.\n\nFinally, you can save your plot and also copy the code that generates the same plot without having to reopen Esquisse!\n\n## Describing a categorical variable\n\nDescribing a numerical variable is nice, but we often have quite a few categorical variables in our datasets. How can we describe them?\n\nThe function `freqtable` from the `questionr` package allows you to get the weighted counts of a categorical variable, and `freq` calculates the corresponding percentages (%val corresponds to the percentages of non-NA categories).\n\nNote that it is always possible to remove the part `weights=finalweight_25per` to get unweighted counts and\n\nHere, we are interested in the variable r2_school_education, which corresponds to the respondents’ school status.\n\n```{r}\n#|eval: false\n\nedu |> freqtable(r2_school_education,weights=finalweight_25per) %>% freq()\nedu |> freqtable(r2_school_education) %>% freq()\nedu |> freqtable(r2_school_education,weights=finalweight_25per) %>% freq() %>% select(-n)\n\n```\n\n## Recoding a categorical variable\n\nNote that the categories of r2_school_education are here coded as 1, 2, and 3. This is because when getting the from the Lanka datta, we got CSV files without any data labels so we need to recode them ourselves based on the questionnaire of the survey.\n\nLuckily, this task can be done very easily by using the `irec()` interface (from the `questionr` package created by Julien Barnier). Type it in the console and the following window will open to recode a new variable with explicit levels (in the R lingo, these are factor levels).\n\n![Esquisse interface](images/Capture%20d’écran%202025-11-21%20à%2018.58.30.png) ![Esquisse interface](images/Capture%20d’écran%202025-11-21%20à%2018.58.37.png) ![Esquisse interface](images/Capture%20d’écran%202025-11-21%20à%2018.58.54.png) The last panel shows you the R code to recode the variable. When clicking on Done, this code is sent to the Console. **We strongly advise you to copy-paste this code into your script to keep track of all your recoding steps!**\n\n::: {.callout-note title=\"Exercise\" icon=\"false\"}\nWith the newly recoded variable of school attendance, recompute the % distribution of this variable. Then, open Esquisse and draw a graph of this variable.\n:::\n\n## Recoding a numerical variable to a categorical variable\n\nIt can be useful to analyze distance to school not as a numerical variable but as a categorical variable (for example, what proportion of students have a school less than 1 km away?).\n\nRecoding a quantitative variable into a qualitative variable is straightforward. In R, we can use another add-in from the questionr package: icut:\n\n```{r}\n#| eval: false\nicut()\n```\n\nYou can then choose the dataset in which you want to recode a variable, select the variable to recode, and specify the name of the recoded variable (by default, the old variable name with \"\\_rec\" added). This add-in relies on R’s cut() function.\n\nDifferent recoding options are offered:\n\n-   Manually (if you have identified key values, or know key thresholds for a variable, for example a poverty level),\n\n-   Using a reclassification algorithm (Jenks, which geographers often use, or other algorithms),\n\n-   Using quantiles, or\n\n-   Using equal-width intervals in the distribution.\n\nHere, we choose to recode the variable into quartiles. The newly created variable corresponds to 4 categories, each roughly representing 25% of the unweighted respondents. However, this division is not always exact, especially when many individuals share the same value — in this case, the number of kilometers.\n\n![Interface de icut](images/Capture%20d’écran%202025-11-21%20à%2019.31.25.png) ![Interface de icut](images/Capture%20d’écran%202025-11-21%20à%2019.37.34.png) ![Interface de icut](images/Capture%20d’écran%202025-11-21%20à%2019.37.45.png)\n\nYou can then click Done. Note that the variable has not yet been created, but in the console, the code to create it is provided. You just need to copy and paste it into your script and run it (you can also modify it directly yourself if you want):\n\n```{r}\n#| eval: false\n\n## Cutting edu$distance into edu$distance_rec\nedu$distance_rec <- cut(edu$distance,\n  include.lowest = TRUE,\n  right = FALSE,\n  dig.lab = 4,\n  breaks = c(0, 1, 2, 4, 84)\n)\n```\n\n::: {.callout-note title=\"Exercise\" icon=\"false\"}\n-    Study the distribution of the newly created variable distance_rec.\n\n-   Save your dataset as a rds file with the name \"edu_rec.rds\".\n:::\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":false,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"statunis.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.5.57","editor":"visual","theme":"cosmo"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}